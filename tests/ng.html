<!DOCTYPE html>
<html>
<head>
    <title>socket.io-rpc test angular client</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--uncomment es5-shim for IE8 support-->
    <!--<script type="text/javascript" src="/es5-shim.js"></script>-->

</head>
<body>
    <h1>Angular socket.io-rpc test/showcase</h1>
    <!--You can also use regular ng-controller, but then you have to load channel yourself by calling
    $rpc.loadChannel('myChannel'); inside it-->
    <div rpc-controller="testCtrl" rpc-channel="myChannel" rpc-auth="local">
        getTime: <span ng-bind="serverTime"></span><br>
        asyncTest: {{ asyncTest }}
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/angular.js"></script>
    <script src="/rpc/rpc-client-angular.js"></script>
    <script>
        angular.module('app', ['RPC']).controller('testCtrl', function ($scope, $rpc, myChannel) {
            myChannel.getTime().then(function (date) {
                console.log('time on server is: ' + date);
                $scope.serverTime = date;
                //no need to call $scope.$apply, because it is called in $rpc;
            });
            myChannel.myAsyncTest('passing string as argument').then(function (retVal) {
                console.log('server returned: ' + retVal);
                $scope.asyncTest = retVal;
            }, function (er) {
                console.error(er);
            });

            myChannel.failingMethod();    // this will display error prpagated from serverside

            console.log('ctr run ' + new Date().toJSON());

        }).run(function ($rpc, $rootScope) {
            $rpc.connect('http://localhost:8081');   // don't forget port, if you are not on 80
            $rpc.auth.local = function () {
                return {passw: '123'};
            };
            console.log('ng run ' + new Date().toJSON());

            $rpc.expose('clientChannel', {
                fnOnClient: function (param) {
                    return 'whatever you need from client returned ' + param;
                }
            }).then(function (channel) {
                console.log(" client channel ready");
            });
        });

        var injector = angular.bootstrap(document, ['app']);

    </script>
</body>

</html>